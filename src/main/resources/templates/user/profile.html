<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Perfil de Usuario - GraFit</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet" />
    <style>
        html,
        body {
            height: 100%;
            margin: 0;
        }

        .wrapper {
            min-height: 100%;
            display: flex;
            flex-direction: column;
        }

        .content {
            flex: 1;
        }

        footer {
            flex-shrink: 0;
            margin-top: auto;
        }

        .profile-header {
            background-color: #dc3545;
            color: white;
            padding: 2rem 0;
            margin-bottom: 2rem;
        }

        .form-label {
            font-weight: 500;
        }

        .input-group-text {
            background-color: #dc3545;
            color: white;
            border: 1px solid #dc3545;
        }
    </style>
</head>

<body>
    <div class="wrapper">
        <div class="content">
            <!-- Navbar -->
            <nav class="navbar navbar-dark bg-black">
                <div class="container-fluid d-flex justify-content-between align-items-center">
                    <button class="btn" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasMenu"
                        aria-controls="offcanvasMenu">
                        <span class="navbar-toggler-icon"></span>
                    </button>
                    <span class="navbar-brand mx-auto h4 mb-0">DATOS DEL ATLETA</span>
                    <form th:action="@{/logout}" method="post">
                        <button type="submit" class="btn btn-outline-danger">
                            <i class="bi bi-box-arrow-left"></i>
                        </button>
                    </form>
                </div>
            </nav>

            <!-- Offcanvas menu -->
            <div class="offcanvas offcanvas-start bg-black" tabindex="-1" id="offcanvasMenu"
                aria-labelledby="offcanvasMenuLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title text-white" id="offcanvasMenuLabel">GraFit</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas"
                        aria-label="Cerrar"></button>
                </div>
                <div class="offcanvas-body">
                    <ul class="nav flex-column">
                        <li class="nav-item mb-2">
                            <a class="nav-link text-white" th:href="@{/home}">
                                <i class="bi bi-house-fill me-2"></i>Inicio
                            </a>
                        </li>
                        <li class="nav-item mb-2">
                            <a class="nav-link text-white active" th:href="@{/profile}">
                                <i class="bi bi-person-fill me-2"></i>Datos del Atleta
                            </a>
                        </li>
                        <li class="nav-item mt-3 mb-1">
                            <h6 class="text-danger text-uppercase fw-bold small">
                                <i class="bi bi-lightning-fill me-2"></i>Ejercicios
                            </h6>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link ps-3 text-white" th:href="@{/exercises}">
                                <i class="bi bi-plus-circle me-2"></i>Crear y Mostrar Ejercicios
                            </a>
                        </li>
                        <li class="nav-item mt-3 mb-1">
                            <h6 class="text-danger text-uppercase fw-bold small">
                                <i class="bi bi-calendar-check-fill me-2"></i>Rutinas
                            </h6>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link ps-3 text-white" th:href="@{/routines}">
                                <i class="bi bi-plus-circle me-2"></i>Crear y Mostrar Rutinas
                            </a>
                        </li>
                        <li class="nav-item mt-3 mb-1">
                            <h6 class="text-danger text-uppercase fw-bold small">
                                <i class="bi bi-graph-up me-2"></i>Estadísticas
                            </h6>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link ps-3 text-white" th:href="@{/statistics}">
                                <i class="bi bi-book-fill me-2"></i>Ver Progreso
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link ps-3 text-white active" th:href="@{/statistics/summary}">
                                <i class="bi bi-book-fill me-2"></i>Resumen
                            </a>
                        </li>
                        <li class="nav-item mt-3 mb-1">
                            <h6 class="text-danger text-uppercase fw-bold small">
                                <i class="bi bi-book-fill me-2"></i>Aprender
                            </h6>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link ps-3 text-white" data-bs-toggle="collapse" href="#collapseAprender">
                                <i class="bi bi-plus-circle me-2"></i>Tutoriales
                            </a>
                            <div class="collapse ms-3" id="collapseAprender">
                                <ul class="nav flex-column">
                                    <li class="nav-item">
                                        <a class="nav-link text-white" th:href="@{/tutorials/press-banca}">
                                            <i class="bi bi-arrow-right me-2"></i>Press Banca
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link text-white" th:href="@{/tutorials/peso-muerto}">
                                            <i class="bi bi-arrow-right me-2"></i>Peso Muerto
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link text-white" th:href="@{/tutorials/sentadilla}">
                                            <i class="bi bi-arrow-right me-2"></i>Sentadilla
                                        </a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link text-white" th:href="@{/tutorials/custom}">
                                            <i class="bi bi-arrow-right me-2"></i>Personalizado
                                        </a>
                                    </li>
                                </ul>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>

            <!-- Profile Content -->
            <div class="profile-header">
                <div class="container">
                    <div class="row align-items-center">
                        <div class="col-auto">
                            <i class="bi bi-person-circle" style="font-size: 4rem;"></i>
                        </div>
                        <div class="col">
                            <h1 class="h3 mb-0" th:text="${user.name + ' ' + user.surname1 + ' ' + user.surname2}">
                                Nombre Completo</h1>
                            <p class="mb-0" th:text="${user.username}">@username</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="container mb-5">
                <div class="row justify-content-center">
                    <div class="col-12 col-lg-8">
                        <div class="card shadow-sm">
                            <div class="card-body p-4">
                                <h2 class="card-title h4 mb-4">Información Personal</h2>

                                <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show"
                                    role="alert">
                                    <i class="bi bi-check-circle-fill me-2"></i>
                                    <span th:text="${successMessage}"></span>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"
                                        aria-label="Close"></button>
                                </div>

                                <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show"
                                    role="alert">
                                    <i class="bi bi-exclamation-triangle-fill me-2"></i>
                                    <span th:text="${errorMessage}"></span>
                                    <button type="button" class="btn-close" data-bs-dismiss="alert"
                                        aria-label="Close"></button>
                                </div>

                                <form th:action="@{/profile/update}" th:object="${user}" method="post"
                                    class="needs-validation" novalidate>
                                    <input type="hidden" th:field="*{id}" />
                                    <input type="hidden" th:field="*{password}" />
                                    <input type="hidden" th:field="*{role}" />
                                    <input type="hidden" th:field="*{dateOfRegister}" />

                                    <div class="row g-3">
                                        <!-- Nombre -->
                                        <div class="col-md-4">
                                            <label for="name" class="form-label">Nombre *</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="bi bi-person-fill"></i></span>
                                                <input type="text" class="form-control" id="name" th:field="*{name}"
                                                    required pattern="^[A-ZÁÉÍÓÚÑ][a-záéíóúñ]+(?: [A-ZÁÉÍÓÚÑ][a-záéíóúñ]+)?$" 
                                                    title="Primera letra mayúscula, resto minúsculas. Puede tener un segundo nombre con el mismo formato"
                                                    maxlength="50">
                                            </div>
                                        </div>

                                        <!-- Apellidos -->
                                        <div class="col-md-4">
                                            <label for="surname1" class="form-label">Primer Apellido *</label>
                                            <input type="text" class="form-control" id="surname1" th:field="*{surname1}"
                                                required pattern="^[A-ZÁÉÍÓÚÑ][a-záéíóúñ]+(?:[- ][A-ZÁÉÍÓÚÑ][a-záéíóúñ]+)?$" 
                                                title="Primera letra mayúscula, resto minúsculas. Puede tener un segundo apellido compuesto con guion o espacio"
                                                maxlength="50">
                                        </div>
                                        <div class="col-md-4">
                                            <label for="surname2" class="form-label">Segundo Apellido</label>
                                            <input type="text" class="form-control" id="surname2" th:field="*{surname2}"
                                                pattern="^[A-ZÁÉÍÓÚÑ][a-záéíóúñ]+(?:[- ][A-ZÁÉÍÓÚÑ][a-záéíóúñ]+)?$" 
                                                title="Primera letra mayúscula, resto minúsculas. Puede tener un segundo apellido compuesto con guion o espacio"
                                                maxlength="50">
                                        </div>

                                        <!-- Username -->
                                        <div class="col-md-6">
                                            <label for="username" class="form-label">Nombre de Usuario *</label>
                                            <div class="input-group">
                                                <span class="input-group-text">@</span>
                                                <input type="text" class="form-control" id="username" th:field="*{username}"
                                                    required pattern="[a-zA-Z0-9_\.@]+" 
                                                    title="Se permiten letras, números, guiones bajos, puntos y @"
                                                    minlength="3" maxlength="20">
                                            </div>
                                        </div>

                                        <!-- Email -->
                                        <div class="col-md-6">
                                            <label for="email" class="form-label">Email *</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="bi bi-envelope-fill"></i></span>
                                                <input type="email" class="form-control" id="email" th:field="*{email}"
                                                    required pattern="[a-z0-9._%+-]+@[a-z0-9.-]+\.[a-z]{2,}$"
                                                    title="Ingrese un email válido">
                                            </div>
                                        </div>

                                        <!-- Teléfono -->
                                        <div class="col-md-6">
                                            <label for="phone" class="form-label">Teléfono</label>
                                            <div class="input-group">
                                                <span class="input-group-text"><i class="bi bi-telephone-fill"></i></span>
                                                <input type="tel" class="form-control" id="phone" th:field="*{phone}"
                                                    pattern="[0-9]{9}" 
                                                    title="El teléfono debe tener 9 dígitos"
                                                    oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                                            </div>
                                        </div>

                                        <!-- Género -->
                                        <div class="col-md-6">
                                            <label for="gender" class="form-label">Género *</label>
                                            <select class="form-select" id="gender" th:field="*{gender}" required>
                                                <option value="MASCULINO">Masculino</option>
                                                <option value="FEMENINO">Femenino</option>
                                                <option value="OTRO">Otro</option>
                                            </select>
                                        </div>

                                        <!-- Altura -->
                                        <div class="col-md-6">
                                            <label for="heightMeters" class="form-label">Altura (metros) *</label>
                                            <div class="input-group">
                                                <input type="number" step="0.01" class="form-control" id="heightMeters"
                                                    th:field="*{heightMeters}" required min="0.5" max="3"
                                                    title="La altura debe estar entre 0.5 y 3 metros">
                                                <span class="input-group-text">m</span>
                                            </div>
                                        </div>

                                        <!-- Peso -->
                                        <div class="col-md-6">
                                            <label for="weightKg" class="form-label">Peso (kg) *</label>
                                            <div class="input-group">
                                                <input type="number" step="0.1" class="form-control" id="weightKg"
                                                    th:field="*{weightKg}" required min="20" max="300"
                                                    title="El peso debe estar entre 20 y 300 kg">
                                                <span class="input-group-text">kg</span>
                                            </div>
                                        </div>

                                        <!-- Medidas antropométricas -->
                                        <div class="row g-3">
                                            <div class="col-md-6">
                                                <label for="armLength" class="form-label">Longitud de Brazos
                                                    <i class="bi bi-info-circle" data-bs-toggle="tooltip"
                                                        title="Mide desde el hombro hasta la muñeca"></i>
                                                </label>
                                                <div class="input-group">
                                                    <input type="number" step="0.1" class="form-control" id="armLength"
                                                        th:field="*{armLength}" min="0">
                                                    <span class="input-group-text">cm</span>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="torsoLength" class="form-label">Longitud del Torso
                                                    <i class="bi bi-info-circle" data-bs-toggle="tooltip"
                                                        title="Mide desde la cadera hasta los hombros"></i>
                                                </label>
                                                <div class="input-group">
                                                    <input type="number" step="0.1" class="form-control" id="torsoLength"
                                                        th:field="*{torsoLength}" min="0">
                                                    <span class="input-group-text">cm</span>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="femurLength" class="form-label">Longitud del Fémur
                                                    <i class="bi bi-info-circle" data-bs-toggle="tooltip"
                                                        title="Mide desde la cadera hasta la rodilla"></i>
                                                </label>
                                                <div class="input-group">
                                                    <input type="number" step="0.1" class="form-control" id="femurLength"
                                                        th:field="*{femurLength}" min="0">
                                                    <span class="input-group-text">cm</span>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <label for="tibiaLength" class="form-label">Longitud de la Tibia
                                                    <i class="bi bi-info-circle" data-bs-toggle="tooltip"
                                                        title="Mide desde la rodilla hasta el tobillo"></i>
                                                </label>
                                                <div class="input-group">
                                                    <input type="number" step="0.1" class="form-control" id="tibiaLength"
                                                        th:field="*{tibiaLength}" min="0">
                                                    <span class="input-group-text">cm</span>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Botones -->
                                        <div class="col-12 mt-4">
                                            <button type="submit" class="btn btn-danger">
                                                <i class="bi bi-save me-2"></i>Guardar Cambios
                                            </button>
                                            <a href="/home" class="btn btn-outline-secondary ms-2">
                                                <i class="bi bi-x-circle me-2"></i>Cancelar
                                            </a>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script th:src="@{/js/user/profile.js}"></script>
</body>

</html>